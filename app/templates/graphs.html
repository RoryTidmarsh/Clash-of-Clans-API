{% extends "base.html" %}

{% block title %}Progress Graphs{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
<div class="progress-graphs pastel-red-title">
    <h1>This feature is under development. Check back later!</h1>
</div>
<div class="main-data-box">
    <section id="filters">
        <label for="player">Players:</label>
        <div class="multi-select-dropdown" style="display: inline-block; min-width: 200px;">
            <button type="button" class="multi-select-trigger" id="player-trigger">
                <span id="filter-select">Select players</span>
                <span class="dropdown-arrow">â–¼</span>
            </button> 
            
            <div class="multi-select-panel" id="player-panel">
                <div>
                    <label class="multi-select-option select-all-option">
                        <input type="checkbox" id="select-all-players">
                        <span>Select All</span>
                    </label>
                    <hr class="multi-select-divider">

                    {% for player in all_players %}
                    <label class="multi-select-option">
                        <input 
                            type="checkbox" 
                            class="player-checkbox" 
                            value="{{ player }}"
                            checked
                        >
                        <span>{{ player }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
        </div>

        <label for="stat-filter">Statistic (Y-Axis):</label>
        <select id="stat-filter">
            {% for stat in available_stats %}
            <option value="{{ stat.value }}" {% if loop.first %}selected{% endif %}>
                {{ stat.label }}
            </option>
            {% endfor %}
        </select>

        <button id="apply-filters" type="button">Apply Filters</button>
        <button id="reset-filters" type="button">Reset Filters</button>
    </section>

    <hr>

    <!-- GRAPH CONTAINER -->
    <section id="graph-section">
        <h3>Performance Chart</h3>
        
        {% if chartjs_data %}
        <!-- Chart will render here -->
        <div class="graph-container" style="position: relative; height: 400px; margin: 20px 0;">
            <div id="labels-display" style="margin-bottom:10px; color:#333;"></div>
                <strong>Labels:</strong>
                <span id="labels-list" style="margin-left:8px;"></span>
            </div>
            <canvas id="lineChart"></canvas>
        </div>
        {% else %}
        <!-- Placeholder when no data -->
        <div class="no-data-message" style="text-align: center; padding: 40px; background: rgba(255,255,255,0.1); border-radius: 8px;">
            <p style="font-size: 18px; color: #666;">
                ğŸ“Š No data to display
            </p>
            <p style="color: #888;">
                Select players and apply filters to generate the graph
            </p>
        </div>
        {% endif %}
    </section>
</div>

<!-- load your static JS which expects chartData to exist -->
<script src="{{ url_for('static', filename='graphs.js') }}"></script>
<script>
    // ğŸ“ Step 1: Receive data from Flask/Jinja2
    // The '|safe' filter tells Jinja2 not to escape the JSON
    // Without it, quotes would become &quot; and break the JavaScript
    {% if chartjs_data %}
        window.chartData = {{ chartjs_data | safe}};
        console.log("ğŸ“Š Chart Data Received:", chartData);
        console.log("ğŸ“… Labels (X-axis):", chartData.labels);
        console.log("ğŸ‘¥ Number of players:", chartData.datasets.length);
    {% else %}
        window.chartData = null;
        console.log("âš ï¸ No chart data available");
    {% endif %}
</script>


{% endblock %}